# 待完善

## 软件

- 自动找到端口 完成

   如果只有一个端口可能被占用，改端口号之后只能通过本机通知其他设备，如果没有中央服务器，那么除非开端口列表，否则大量设备修改端口将都会找不到，
   开端口列表将会让原本的一次访问变为多次

- 全局单例 完成

   只需要一个实例

- 支持命令行下载

   判断如果没有开启，那么开启服务进行下载。判断如果已经开启，发起 请求 然后退出

## 发现机制

- 获取本机的 IP 和端口 完成

- 中央服务器发现

   需要上报中央服务器这个设备的名字，地址和端口

   使用 BT 服务器做中央服务器

- 组播发现 完成

- 关系维护 完成

   如何告诉其他设备当前设备开机

- 读取本地上次找到的设备 完成

   局域网的设备的 IP 不会不断变化，可以保存在本地，下一次打开的时候可以找到上次连接

- 和其他设备联系的时候包含当前设备信息 完成

   传输的时候加上设备信息

- 报告主IP是哪个 完成

   在被访问的时候，返回客户端访问的IP是哪个，这样客户端就可以将这个IP作为主IP地址，下次扫局域网的时候就可以使用这个IP地址

## 上传

- 忙碌自动拒绝

   不能让一个设备同时给很多设备提供上传这样会让这个设备太卡

   在这个设备进行耗性能的时候，就不执行上传

- 保留资源但不提供下载功能

   不是所有资源都需要立刻下载，如果发现本地有资源，可以做延迟下载，如果本地的服务器太忙碌，那么可以等待本地服务器空闲才进行下载

- 支持上传文件夹
- 上传文件在后台签名
- 支持上传之前给签名
- 去掉重复上传资源 完成

## 下载

- 下载清单

   包含下载内容文件，需要有额外信息支持，需要有 tracer 发布服务器，和下载源

- 下载链机制

   支持一边下载一边发现新的设备多个设备进行下载

- 多端下载

   一个文件可以从多个服务器端下载

- 自动去掉下载慢的设备

   如果有一个设备提供的下载速度过慢，可以排除这个设备

- 处理下载的文件在文件夹存在

   可选是覆盖、重命名、报告无法下载

## 文件管理

- 文件校验机制
- 下载资源相对路径拼接的安全性
- 自动扫描文件变更

   如果变更了文件，就需要更新数据库内容

- 可以向中央服务器注册本机资源
- 包含资源属于哪个用户
- 过时资源处理

   有一些资源注册之后就不再使用，但是如果用户本地文件不清理，那么可以忽略。如果用户本地文件清理了，那么才删掉文件。原因是假定有 1024*1024 个文件，
   假定一个文件是 1M 那么将会占用 1T 磁盘空间，而此时的查询速度依旧保持在100ms内

## 性能

- 限制上传和下载速度

- 内存占用优化

   也许需要时不时自动重启

## 设备信息

- 包含设备名 完成
- 局域网连接的设备 完成
- 注册的文件和对应的 id 和路径

## 更新

数据兼容

- 注册的文件
- 之前连接的设备

- 推送更新文件

## 下载库

提供给其他程序的下载库

- 原有下载 完成
- 同时从服务器和从局域网下载，下载到两个文件 完成
- 判断两个线路哪个先下载完成 完成
- 修改下载文件名 完成

- 下载P2P服务

   需要找下载地址

- 启动P2P服务 完成
- 判断P2P启动 完成

- 打包

- 优化服务打包方法

   在打包之前需要修改 build/VersionConfig.json 的版本号，然后修改 `build\SimpleBuild\DotnetCampusP2PFileShare_QuickBuild.iss` 里面的版本号

## 上报

- 上报命中资源 完成
- 上报下载速度 完成
- 局域网连接上的设备 完成
- 上传的文件 完成
- 本地总文件数 暂时不需要

## 杂项

- 考虑冰点的数据放在哪个文件夹

